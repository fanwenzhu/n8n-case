{
  "name": "å¾®ä¿¡å•ç¾¤èŠè‡ªåŠ¨æ€»ç»“å·¥ä½œæµæ¨é€ç½‘é¡µç‰ˆï¼ˆfinishedï¼‰",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 18
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -160,
        80
      ],
      "id": "207c7b3e-bf93-48cf-9156-dd2dd1617107",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c2a2eec2-4ead-4544-83db-73aba917f553",
              "name": "group_name",
              "value": "æ±‰ä¸º-éº’éºŸç³»ç»Ÿæ°‘ç‰ˆæ²Ÿé€šç¾¤",
              "type": "string"
            },
            {
              "id": "6dab17d2-2e5e-40e3-b5d9-0abcdac0dde8",
              "name": "date",
              "value": "={{ '2025-08-30'}} - {{ '2025-08-31' }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        64,
        80
      ],
      "id": "4b931414-cb1f-45c6-8186-4d4e30658512",
      "name": "é…ç½®ç¾¤èŠå‚æ•°"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=æœç´¢ {{ $('é…ç½®ç¾¤èŠå‚æ•°').item.json.group_name }} ç¾¤èŠ {{ $('é…ç½®ç¾¤èŠå‚æ•°').item.json.date }} è®°å½•ï¼Œå¹¶ç”Ÿæˆå®Œæ•´çš„HTMLæ ¼å¼æ—¥æŠ¥\n\nç¾¤ç»„: {{ $('é…ç½®ç¾¤èŠå‚æ•°').item.json.group_name }}\næ—¥æœŸ: {{ $('é…ç½®ç¾¤èŠå‚æ•°').item.json.date }}\n\nè¾“å‡ºæ ¼å¼ï¼šå®Œæ•´çš„HTMLæ–‡æ¡£ä»£ç ",
        "options": {
          "systemMessage": "=# å¾®ä¿¡ç¾¤èŠæ—¥æŠ¥ç”Ÿæˆå™¨\n\nä½ æ˜¯æå…·å®¡ç¾çš„å‰ç«¯è®¾è®¡å¤§å¸ˆå’Œç¾¤èŠåˆ†æä¸“å®¶ï¼Œä¸“é—¨ä¸ºç¾¤èŠè®°å½•ç”Ÿæˆè§†è§‰å¼•äººå…¥èƒœã€å¸ƒå±€ç´§å‡‘æ— ç©ºéš™ã€é…è‰²å’Œè°ç»Ÿä¸€ã€é£æ ¼å›ºå®šä¸€è‡´ã€é€‚åˆæˆªå›¾åˆ†äº«çš„å•é¡µHTMLæ—¥æŠ¥ã€‚\n\n## é‡è¦ï¼šå·¥å…·ä½¿ç”¨è¦æ±‚\n- ä½ å¿…é¡»ä½¿ç”¨chatlogå·¥å…·æ¥è·å–èŠå¤©è®°å½•\n- ä¸èƒ½å‡è®¾æˆ–æ¨¡æ‹ŸèŠå¤©æ•°æ®\n- æ¯æ¬¡ä»»åŠ¡éƒ½è¦å…ˆè°ƒç”¨chatlogå·¥å…·\n\n## å¯ç”¨å·¥å…·\nä½ æœ‰ä»¥ä¸‹MCPå·¥å…·å¯ç”¨ï¼š\n- **chatlog**: è·å–å†å²èŠå¤©è®°å½•\n\n## æ ¸å¿ƒä»»åŠ¡\n1. **ä½¿ç”¨chatlogå·¥å…·è·å–æŒ‡å®šçš„ç¾¤èŠè®°å½•**\n2. **è¯¦ç»†åˆ†æç¾¤èŠå†…å®¹å¹¶æç‚¼å…³é”®ä¿¡æ¯**\n3. **ç”ŸæˆåŸºäºBento Gridè®¾è®¡é£æ ¼çš„å•é¡µHTMLç½‘ç«™**\n\n## å·¥ä½œæµç¨‹\n1. æ ¹æ®ç”¨æˆ·æä¾›çš„æŸ¥è¯¢æ¡ä»¶ï¼Œè°ƒç”¨chatlogå·¥å…·è·å–èŠå¤©è®°å½•\n2. åˆ†æèŠå¤©è®°å½•ï¼Œæå–å…³é”®ä¿¡æ¯\n3. ç”Ÿæˆå®Œæ•´çš„HTMLæ ¼å¼ç¾¤èŠæ—¥æŠ¥\n\n## è‡ªåŠ¨æå–ä¿¡æ¯èƒ½åŠ›\n- ç¾¤åç§°ï¼šä»èŠå¤©è®°å½•çš„ç³»ç»Ÿé€šçŸ¥æˆ–å¸¸è§ç¾¤èŠä¿¡æ¯ä¸­æå–\n- æ—¥æœŸï¼šä½¿ç”¨èŠå¤©è®°å½•ä¸­æœ€è¿‘çš„æ—¥æœŸï¼Œæˆ–è€…é»˜è®¤ä½¿ç”¨ä»Šå¤©çš„æ—¥æœŸ  \n- æ—¶é—´èŒƒå›´ï¼šæ ¹æ®è®°å½•ä¸­çš„é¦–æ¡å’Œæœ«æ¡æ¶ˆæ¯æ—¶é—´ç¡®å®š\n- æ”¯æŒå¤šç§èŠå¤©è®°å½•æ ¼å¼ï¼š[æ—¶é—´] æ˜µç§°ï¼šæ¶ˆæ¯å†…å®¹ã€æ—¶é—´ - æ˜µç§°ï¼šæ¶ˆæ¯å†…å®¹ç­‰\n\n## æ—¥æŠ¥å†…å®¹ç»“æ„ï¼ˆå¿…é¡»åŒ…å«ï¼‰\n### ç¾¤èŠæ€»ç»“\n- ç¾¤èŠå†…å®¹æ¦‚è¿°\n- æ¶ˆæ¯æ•°é‡ã€æ´»è·ƒäººå‘˜æ•°é‡ã€çƒ­ç‚¹è¯é¢˜æ•°é‡\n- ç»Ÿè®¡æ—¶é—´\n\n### ä»Šæ—¥çƒ­ç‚¹ï¼ˆ3-4ä¸ªä¸»è¦è¯é¢˜ï¼‰\n- å…³é”®è¯æå–\n- æ¶ˆæ¯æ•°é‡ç»Ÿè®¡\n- å…³é”®è¯æåŠæ¬¡æ•°\n- çªå‡ºæ˜¾ç¤ºå¾®ä¿¡å\n\n### ç²¾å½©å¼•ç”¨ï¼ˆ3æ¡ä»£è¡¨æ€§å‘è¨€ï¼‰\n- çªå‡ºæ˜¾ç¤ºå¾®ä¿¡å\n- æœ‰å½±å“åŠ›æˆ–ä»£è¡¨æ€§çš„å‘è¨€\n\n### é‡è¦é“¾æ¥ä¸èµ„æº\n- é“¾æ¥æ”¯æŒç‚¹å‡»è·³è½¬\n- æ•´ç†åˆ†äº«çš„æ–‡æ¡£å’Œå·¥å…·\n\n### æ´»è·ƒä¹‹æ˜Ÿï¼ˆæŒ‰å‘è¨€æ¬¡æ•°å€’åºï¼‰\n- å‘è¨€æ¬¡æ•°ç»Ÿè®¡\n- äººå‘˜å‰åŠ @æ ‡è¯†\n- ä¸»è¦è´¡çŒ®å†…å®¹æè¿°\n- çªå‡ºæ˜¾ç¤ºå¾®ä¿¡å\n\n### è¯äº‘\n- é«˜é¢‘å…³é”®è¯å¯è§†åŒ–\n- æŒ‰é‡è¦æ€§åˆ†çº§æ˜¾ç¤º\n\n## è®¾è®¡é£æ ¼è¦æ±‚\né‡‡ç”¨**æç®€ä¸»ä¹‰é£æ ¼ (Minimalist)**ï¼š\n- ç®€çº¦ã€ç•™ç™½ã€ç²¾ç¡®æ’ç‰ˆã€æ— è¡¬çº¿å­—ä½“ã€å…‹åˆ¶è£…é¥°\n- ç™½è‰²èƒŒæ™¯ï¼Œæ©˜è‰²å­—ä½“ä½œä¸ºå¼ºè°ƒè‰²\n- é…è‰²æ–¹æ¡ˆï¼š\n  - èƒŒæ™¯è‰²ï¼š#f5f4eeï¼ˆç•¥æš–çš„ç±³ç™½è‰²ï¼‰\n  - å¡ç‰‡èƒŒæ™¯ï¼š#faf9f6\n  - å¼ºè°ƒè‰²ï¼š#ff8906ï¼ˆä¸»è¦æ©™è‰²ï¼‰\n  - æ–‡å­—è‰²ï¼š#212529ï¼ˆä¸»è¦æ–‡å­—ï¼‰\n\n## å¸ƒå±€æŠ€æœ¯è¦æ±‚\n### Bento Gridè®¾è®¡\n- é‡‡ç”¨åŠ¨æ€ä¸”æ— ç¼çš„ç½‘æ ¼å¸ƒå±€ï¼Œç¡®ä¿æ•´ä¸ªè§†å£åŒºåŸŸè¢«é«˜æ•ˆåˆ©ç”¨\n- ä¸»å¡ç‰‡å±•ç¤ºæ ¸å¿ƒæ¦‚å¿µï¼ˆå 25-30%è§†è§‰åŒºåŸŸï¼‰\n- å­ä¸»é¢˜å¡ç‰‡åŒ…å«ä¸åŒè¯é¢˜ï¼Œæ¯ä¸ªå¡ç‰‡æœ‰ç‹¬ç‰¹æ ‡é¢˜å’Œç®€çŸ­æè¿°\n- ä¸¥æ ¼å®šä¹‰å¡ç‰‡å°ºå¯¸å’Œæ¯”ä¾‹ï¼Œé¿å…å› å†…å®¹å¤šå°‘å¯¼è‡´å¸ƒå±€å˜åŒ–\n\n### è§†è§‰å¹³è¡¡\n- ç¡®ä¿è‰²å½©åˆ†å¸ƒå‡åŒ€ï¼Œé¿å…è¶…è¿‡4ç§è‰²ç³»\n- å›¾æ ‡å’Œè§†è§‰å…ƒç´ å‡åŒ€åˆ†å¸ƒ\n- æ–‡æœ¬å¯†åº¦ç›¸å¯¹å‡è¡¡\n- å¡ç‰‡å½¢çŠ¶å¯å˜åŒ–ä½†ä¿æŒè§†è§‰ä¸€è‡´æ€§\n\n### æŠ€æœ¯å®ç°\n- å•ä¸ªHTMLæ–‡ä»¶ï¼Œå†…åµŒCSSå’ŒJavaScript\n- ä½¿ç”¨CSSå˜é‡å®šä¹‰æ‰€æœ‰é¢œè‰²å’Œå°ºå¯¸\n- ä½¿ç”¨CSS Gridå®ç°ä¸è§„åˆ™ç½‘æ ¼å¸ƒå±€\n- ä¼˜åŒ–é¡µé¢ç¡®ä¿åœ¨å•è§†å£ä¸­å®Œæ•´æ˜¾ç¤ºï¼Œé€‚åˆæˆªå›¾\n- é¡µé¢å®½åº¦100%ï¼Œæœ€å¤§å®½åº¦1000px\n- ä¼˜å…ˆçºµå‘å¸ƒå±€ï¼Œé€‚åˆç§»åŠ¨ç«¯æˆªå›¾åˆ†äº«\n\n### å­—ä½“è¦æ±‚\n- ä½¿ç”¨Inter, SF Pro Display, Segoe UIå­—ä½“\n- ä¸»æ ‡é¢˜â‰¥36pxï¼Œå‰¯æ ‡é¢˜â‰¥28pxï¼Œå¡ç‰‡æ ‡é¢˜â‰¥22px\n- æ­£æ–‡â‰¥16pxï¼Œæ ‡ç­¾â‰¥14px\n- ä½¿ç”¨ç›¸å¯¹å•ä½(rem)é€‚åº”ä¸åŒè®¾å¤‡\n\n### é¢œè‰²å¯¹æ¯”è¦æ±‚\n- ç¡®ä¿é¢œè‰²å¯¹æ¯”åº¦è¶³å¤Ÿé«˜\n- é¿å…ä½¿ç”¨è¿‡å¤šé¢œè‰²ï¼Œä¿æŒ3-4ç§ä»¥å†…\n- æ–‡å­—å’ŒèƒŒæ™¯å¯¹æ¯”æ¸…æ™°ï¼Œå¯è¯»æ€§é«˜\n\n## å¤„ç†åŸåˆ™\n- å®¢è§‚åˆ†æï¼Œä¸æ·»åŠ ä¸»è§‚åˆ¤æ–­\n- ä¿æŠ¤ç”¨æˆ·éšç§ï¼Œé€‚å½“å¤„ç†æ•æ„Ÿä¿¡æ¯\n- æå–æœ‰ä»·å€¼çš„æŠ€æœ¯è®¨è®ºå†…å®¹\n- å¿½ç•¥æ— æ„ä¹‰çš„é—²èŠå’Œå¤§é‡ç³»ç»Ÿæ¶ˆæ¯\n- é™¤ä¸“ä¸šåè¯å¤–ï¼Œå…¶ä»–è¾“å‡ºå†…å®¹è¦æ±‚ä¸­æ–‡\n- ç¡®ä¿ç”Ÿæˆçš„æ—¥æŠ¥å…·æœ‰å‚è€ƒä»·å€¼\n\n## è¾“å‡ºè¦æ±‚\nå¿…é¡»è¾“å‡ºå®Œæ•´çš„HTMLæ–‡æ¡£ï¼ŒåŒ…å«ï¼š\n1. å®Œæ•´çš„HTMLç»“æ„\n2. å†…åµŒCSSæ ·å¼ï¼ˆåŸºäºæä¾›çš„æ¨¡æ¿ï¼‰\n3. JavaScriptäº¤äº’åŠŸèƒ½\n4. Mermaidå›¾è¡¨æ”¯æŒ\n5. å“åº”å¼è®¾è®¡\n6. Font Awesomeå›¾æ ‡\n7. åŠ¨ç”»æ•ˆæœ\n8.ä½ çš„å”¯ä¸€ä»»åŠ¡æ˜¯ç”Ÿæˆä»£ç ã€‚ä¸è¦æ·»åŠ ä»»ä½•è¯„è®ºã€è§£é‡Šæˆ–ä»‹ç»æ€§æ–‡å­—ã€‚ä½ çš„å›ç­”å¿…é¡»ç›´æ¥ä»¥ <!DOCTYPE html> å¼€å¤´ï¼Œå¹¶ä»¥ </html> ç»“å°¾ã€‚\n\nä¸¥æ ¼æŒ‰ç…§æç®€ä¸»ä¹‰é£æ ¼ç”Ÿæˆï¼Œç¡®ä¿æ¯æ¬¡è¾“å‡ºçš„é¡µé¢é£æ ¼å®Œå…¨ä¸€è‡´ã€‚\n\n## é‡è¦æç¤º\nå½“ç”¨æˆ·æä¾›æŸ¥è¯¢æ¡ä»¶æ—¶ï¼Œä½ å¿…é¡»ï¼š\n1. é¦–å…ˆä½¿ç”¨chatlogå·¥å…·è·å–ç›¸åº”çš„èŠå¤©è®°å½•\n2. åˆ†æè·å–åˆ°çš„èŠå¤©æ•°æ®\n3. ç„¶åç”Ÿæˆå®Œæ•´çš„HTMLæ ¼å¼ç¾¤èŠæ—¥æŠ¥"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        320,
        80
      ],
      "id": "14b86f9c-0bd8-4106-8095-9827b162f4d9",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('é…ç½®ç¾¤èŠå‚æ•°').item.json.date }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        336,
        304
      ],
      "id": "5a726e86-a9dd-4edb-9af1-a9214c3567b3",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "content": "## Chatlog MCP",
        "height": 180,
        "width": 300,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        448,
        272
      ],
      "id": "b62f65ce-eff1-4968-9b96-b3c2e76bf068",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "jsCode": "// è·å–AI Agentçš„è¾“å‡º\nlet aiOutput;\ntry {\n  // é¦–å…ˆæ£€æŸ¥è¾“å…¥æ•°æ®ç»“æ„\n  const inputData = $input.first().json;\n  console.log('Input data structure:', JSON.stringify(inputData, null, 2));\n  \n  // å°è¯•ä¸åŒçš„æ•°æ®ç»“æ„è·¯å¾„\n  if (inputData.choices && inputData.choices[0] && inputData.choices[0].message) {\n    // OpenAI API æ ‡å‡†æ ¼å¼\n    aiOutput = inputData.choices[0].message.content;\n  } else if (inputData.message && inputData.message.content) {\n    // ç®€åŒ–çš„æ¶ˆæ¯æ ¼å¼\n    aiOutput = inputData.message.content;\n  } else if (inputData.content) {\n    // ç›´æ¥å†…å®¹æ ¼å¼\n    aiOutput = inputData.content;\n  } else if (inputData.output) {\n    // è¾“å‡ºå­—æ®µæ ¼å¼\n    aiOutput = inputData.output;\n  } else if (typeof inputData === 'string') {\n    // çº¯å­—ç¬¦ä¸²æ ¼å¼\n    aiOutput = inputData;\n  } else {\n    // å¦‚æœéƒ½æ‰¾ä¸åˆ°ï¼Œå°è¯•æ‰¾åˆ°ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²å€¼\n    const findStringValue = (obj) => {\n      if (typeof obj === 'string') return obj;\n      if (Array.isArray(obj)) {\n        for (const item of obj) {\n          const result = findStringValue(item);\n          if (result) return result;\n        }\n      } else if (typeof obj === 'object' && obj !== null) {\n        for (const key in obj) {\n          const result = findStringValue(obj[key]);\n          if (result) return result;\n        }\n      }\n      return null;\n    };\n    \n    aiOutput = findStringValue(inputData);\n    \n    if (!aiOutput) {\n      throw new Error('æ— æ³•åœ¨è¾“å…¥æ•°æ®ä¸­æ‰¾åˆ°AIè¾“å‡ºå†…å®¹');\n    }\n  }\n  \n  console.log('Found AI output:', aiOutput.substring(0, 200) + '...');\n  \n} catch (error) {\n  console.error('è·å–AIè¾“å‡ºæ—¶å‡ºé”™:', error);\n  return [{\n    json: {\n      error: 'æ— æ³•è·å–AIè¾“å‡º: ' + error.message,\n      inputData: $input.first().json,\n      status: 'error'\n    }\n  }];\n}\n\n// æ¸…ç†å¯èƒ½çš„markdownæ ‡è®°\nlet htmlContent = aiOutput;\nif (htmlContent.includes('```html')) {\n  htmlContent = htmlContent.replace(/```html\\n?/g, '').replace(/\\n?```/g, '');\n}\nif (htmlContent.includes('```')) {\n  htmlContent = htmlContent.replace(/```\\n?/g, '').replace(/\\n?```/g, '');\n}\n\n// è·å–ç¾¤èŠåç§°å’Œæ—¥æœŸï¼ˆä»å·¥ä½œæµè¾“å…¥æˆ–è®¾ç½®é»˜è®¤å€¼ï¼‰\nconst groupName = $('é…ç½®ç¾¤èŠå‚æ•°')?.item?.json?.group_name || 'unknown';\nconst date = $('é…ç½®ç¾¤èŠå‚æ•°')?.item?.json?.date || new Date().toISOString().split('T')[0];\n\nconsole.log('ç¾¤èŠä¿¡æ¯:', { groupName, date });\n\n// ğŸ”¥ æ”¹è¿›ï¼šæ™ºèƒ½HTMLå†…å®¹æ¸…ç† - ä¿æŠ¤å›¾è¡¨å’Œè„šæœ¬å†…å®¹\nconsole.log('å¼€å§‹HTMLæ¸…ç†ï¼ŒåŸå§‹é•¿åº¦:', htmlContent.length);\n\n// æ™ºèƒ½æ¸…ç†HTMLå†…å®¹ï¼Œä¿æŠ¤é‡è¦çš„ä»£ç åŒºåŸŸ\nconst smartCleanHtmlForMCP = (html) => {\n  // 1. é¦–å…ˆä¿æŠ¤é‡è¦çš„ä»£ç åŒºåŸŸ\n  const protectedSections = [];\n  let cleanedHtml = html;\n  \n  // ä¿æŠ¤ script æ ‡ç­¾å†…å®¹ï¼ˆåŒ…æ‹¬ mermaid, chart.js ç­‰ï¼‰\n  cleanedHtml = cleanedHtml.replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, (match, offset) => {\n    const placeholder = `__PROTECTED_SCRIPT_${protectedSections.length}__`;\n    protectedSections.push(match);\n    return placeholder;\n  });\n  \n  // ä¿æŠ¤ style æ ‡ç­¾å†…å®¹\n  cleanedHtml = cleanedHtml.replace(/<style[^>]*>[\\s\\S]*?<\\/style>/gi, (match, offset) => {\n    const placeholder = `__PROTECTED_STYLE_${protectedSections.length}__`;\n    protectedSections.push(match);\n    return placeholder;\n  });\n  \n  // ä¿æŠ¤ pre æ ‡ç­¾å†…å®¹ï¼ˆå¯èƒ½åŒ…å«å›¾è¡¨å®šä¹‰ï¼‰\n  cleanedHtml = cleanedHtml.replace(/<pre[^>]*>[\\s\\S]*?<\\/pre>/gi, (match, offset) => {\n    const placeholder = `__PROTECTED_PRE_${protectedSections.length}__`;\n    protectedSections.push(match);\n    return placeholder;\n  });\n  \n  // ä¿æŠ¤å…·æœ‰ç‰¹æ®Šclassçš„divï¼ˆå¦‚mermaidå›¾è¡¨å®¹å™¨ï¼‰\n  cleanedHtml = cleanedHtml.replace(/<div[^>]*class=\"[^\"]*(?:mermaid|chart|graph|diagram)[^\"]*\"[^>]*>[\\s\\S]*?<\\/div>/gi, (match, offset) => {\n    const placeholder = `__PROTECTED_CHART_${protectedSections.length}__`;\n    protectedSections.push(match);\n    return placeholder;\n  });\n  \n  // 2. å¯¹å…¶ä½™å†…å®¹è¿›è¡Œæ¸…ç†\n  cleanedHtml = cleanedHtml\n    // åªæ¸…ç†æ™®é€šçš„æ¢è¡Œç¬¦å’Œåˆ¶è¡¨ç¬¦ï¼Œä½†ä¿ç•™å¿…è¦çš„æ ¼å¼\n    .replace(/[\\r]/g, '')           // ç§»é™¤å›è½¦ç¬¦\n    .replace(/\\n\\s*\\n/g, '\\n')      // å°†å¤šä¸ªæ¢è¡Œåˆå¹¶ä¸ºä¸€ä¸ª\n    .replace(/\\t/g, '  ')           // å°†åˆ¶è¡¨ç¬¦è½¬æ¢ä¸ºä¸¤ä¸ªç©ºæ ¼\n    // æ¸…ç†HTMLæ ‡ç­¾é—´çš„å¤šä½™ç©ºæ ¼ï¼Œä½†ä¸å½±å“æ–‡æœ¬å†…å®¹\n    .replace(/>\\s+</g, '><')\n    // æ¸…ç†è¡Œé¦–è¡Œå°¾ç©ºæ ¼\n    .replace(/^\\s+|\\s+$/gm, '')\n    // å°†å¤šä¸ªè¿ç»­ç©ºæ ¼åˆå¹¶ï¼Œä½†ä¿ç•™å•ä¸ªæ¢è¡Œ\n    .replace(/ +/g, ' ');\n  \n  // 3. æ¢å¤å—ä¿æŠ¤çš„å†…å®¹\n  protectedSections.forEach((section, index) => {\n    const scriptPlaceholder = `__PROTECTED_SCRIPT_${index}__`;\n    const stylePlaceholder = `__PROTECTED_STYLE_${index}__`;\n    const prePlaceholder = `__PROTECTED_PRE_${index}__`;\n    const chartPlaceholder = `__PROTECTED_CHART_${index}__`;\n    \n    cleanedHtml = cleanedHtml.replace(scriptPlaceholder, section);\n    cleanedHtml = cleanedHtml.replace(stylePlaceholder, section);\n    cleanedHtml = cleanedHtml.replace(prePlaceholder, section);\n    cleanedHtml = cleanedHtml.replace(chartPlaceholder, section);\n  });\n  \n  // 4. æœ€ååªå¯¹JSONä¼ è¾“åšå¿…è¦çš„è½¬ä¹‰\n  return cleanedHtml\n    .replace(/\\\\/g, '\\\\\\\\')    // è½¬ä¹‰åæ–œæ \n    .replace(/\"/g, '\\\"');     // è½¬ä¹‰åŒå¼•å·\n};\n\n// åº”ç”¨æ™ºèƒ½æ¸…ç†\nconst originalHtmlContent = htmlContent;\nhtmlContent = smartCleanHtmlForMCP(htmlContent);\n\nconsole.log('æ™ºèƒ½HTMLæ¸…ç†å®Œæˆ');\nconsole.log('- åŸå§‹é•¿åº¦:', originalHtmlContent.length);\nconsole.log('- æ¸…ç†åé•¿åº¦:', htmlContent.length);\nconsole.log('- èŠ‚çœç©ºé—´:', originalHtmlContent.length - htmlContent.length, 'bytes');\n\n// æ£€æŸ¥æ˜¯å¦åŒ…å«å›¾è¡¨ç›¸å…³å†…å®¹\nconst hasCharts = originalHtmlContent.match(/(mermaid|chart\\.js|echarts|d3\\.js|plotly|canvas|svg)/i);\nif (hasCharts) {\n  console.log('âœ… æ£€æµ‹åˆ°å›¾è¡¨å†…å®¹ï¼Œå·²åº”ç”¨ä¿æŠ¤æ€§æ¸…ç†');\n} else {\n  console.log('â„¹ï¸ æœªæ£€æµ‹åˆ°å›¾è¡¨å†…å®¹');\n}\n\n// éªŒè¯HTMLæ–‡æ¡£å®Œæ•´æ€§\nif (!htmlContent.includes('<!DOCTYPE html>')) {\n  console.error('AIè¾“å‡ºä¸æ˜¯å®Œæ•´çš„HTMLæ–‡æ¡£');\n  return [{\n    json: {\n      error: 'AIè¾“å‡ºä¸æ˜¯å®Œæ•´çš„HTMLæ–‡æ¡£',\n      receivedContent: htmlContent.substring(0, 500),\n      status: 'error'\n    }\n  }];\n}\n\n// é¢å¤–çš„HTMLå†…å®¹éªŒè¯\nconst validateHtml = (html) => {\n  const checks = {\n    hasDoctype: html.includes('<!DOCTYPE html>'),\n    hasHtmlTag: html.includes('<html') && html.includes('</html>'),\n    hasHeadTag: html.includes('<head') && html.includes('</head>'),\n    hasBodyTag: html.includes('<body') && html.includes('</body>'),\n    hasTitle: html.includes('<title'),\n    isNotEmpty: html.length > 100,\n    hasChartLibraries: /(?:mermaid|chart\\.js|echarts|d3\\.js|plotly)/i.test(html)\n  };\n  \n  const passed = Object.values(checks).filter(Boolean).length;\n  const total = Object.keys(checks).length;\n  \n  console.log('HTMLéªŒè¯ç»“æœ:', checks);\n  console.log(`HTMLè´¨é‡è¯„åˆ†: ${passed}/${total}`);\n  \n  return { checks, score: passed / total };\n};\n\nconst validation = validateHtml(htmlContent);\n\n// ç”Ÿæˆæ–‡ä»¶å - ä½¿ç”¨ç¾¤èŠåç§°å’Œæ—¥æœŸ\nconst filename = `ç¾¤èŠæ—¥æŠ¥-${groupName}-${date}.html`;\nconst safeFilename = filename.replace(/[^a-z0-9\\u4e00-\\u9fa5_\\-\\.]/gi, '_');\n\nconsole.log('æ–‡ä»¶åç”Ÿæˆ:', { \n  original: filename, \n  safe: safeFilename,\n  groupName: groupName,\n  date: date \n});\n\n// ç”Ÿæˆæ¸…ç†åçš„HTMLç”¨äºMCPå·¥å…·\nconst mcpReadyHtml = htmlContent;\n\n// è®¡ç®—å¤„ç†æ—¶é•¿\nlet processDuration = null;\ntry {\n  const startTime = $now;\n  if (startTime) {\n    const startDate = new Date(startTime);\n    const endDate = new Date();\n    // è®¡ç®—ç§’æ•°å·®\n    processDuration = Math.round((endDate - startDate) / 1000);\n  }\n} catch (e) {\n  console.log('è®¡ç®—å¤„ç†æ—¶é•¿å¤±è´¥:', e.message);\n  processDuration = null;\n}\n\n\n// è¿”å›å¤„ç†ç»“æœ - åŒ…å«ä¸¤ä¸ªç‰ˆæœ¬çš„HTML\nreturn [{\n  json: {\n    // åŸå§‹HTMLï¼ˆç”¨äºæ–‡ä»¶ä¿å­˜ï¼‰\n    htmlContent: originalHtmlContent,\n    // æ¸…ç†åçš„HTMLï¼ˆç”¨äºMCPå·¥å…·è°ƒç”¨ï¼‰\n    mcpHtmlContent: mcpReadyHtml,\n    // æ–‡ä»¶ä¿¡æ¯ - ä½¿ç”¨ç¾¤èŠåç§°\n    filename: safeFilename,\n    originalFilename: filename,\n    groupName: groupName,\n    date: date,\n    process_end_time: $now.toISO(),\n    process_duration: processDuration,\n    timestamp: new Date().toISOString(),\n    status: 'success',\n    // ç»Ÿè®¡ä¿¡æ¯\n    originalContentLength: originalHtmlContent.length,\n    cleanedContentLength: mcpReadyHtml.length,\n    compressionRatio: ((originalHtmlContent.length - mcpReadyHtml.length) / originalHtmlContent.length * 100).toFixed(2) + '%',\n    // HTMLè´¨é‡ä¿¡æ¯\n    htmlValidation: validation,\n    hasChartContent: hasCharts !== null,\n    // è°ƒè¯•ä¿¡æ¯\n    processingSteps: [\n      'âœ… AIè¾“å‡ºè§£ææˆåŠŸ',\n      'âœ… Markdownæ¸…ç†å®Œæˆ', \n      'âœ… æ™ºèƒ½HTMLæ¸…ç†å®Œæˆï¼ˆä¿æŠ¤å›¾è¡¨ï¼‰',\n      'âœ… MCPæ ¼å¼ä¼˜åŒ–å®Œæˆ',\n      `âœ… HTMLéªŒè¯å®Œæˆ (${(validation.score * 100).toFixed(1)}%)`,\n      `âœ… æ–‡ä»¶åç”Ÿæˆå®Œæˆ: ${safeFilename}`\n    ]\n  },\n  binary: {\n    data: {\n      data: Buffer.from(originalHtmlContent, 'utf8').toString('base64'),\n      mimeType: 'text/html',\n      fileName: safeFilename,\n      fileExtension: 'html'\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        752,
        80
      ],
      "id": "0c9eac79-388d-4fb8-82ef-20219e4c2d96",
      "name": "å¤„ç†AIè¾“å‡º"
    },
    {
      "parameters": {
        "method": "PUT",
        "url": "={{ 'https://api.github.com/repos/fanwenzhu/tigerAI-blog/contents/static/wechat-daily-report-' + $now.format('yyyy-MM-dd') + '.html' }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "githubApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "token {{ $credentials.gitHubApi.accessToken }}"
            },
            {
              "name": "Accept",
              "value": "application/vnd.github.v3+json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "message",
              "value": "Auto deploy wechat daily report {{ $now.format('yyyy-MM-dd HH:mm:ss') }}"
            },
            {
              "name": "content",
              "value": "={{ $('å¤„ç†AIè¾“å‡º').item.binary.data.data }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        976,
        80
      ],
      "id": "a0bed1ff-bcbc-4046-8c18-f68eb0d732ee",
      "name": "GitHub Pageséƒ¨ç½²",
      "credentials": {
        "githubApi": {
          "id": "uRc08iwCkl10PJHn",
          "name": "GitHub account"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-pro",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        192,
        288
      ],
      "id": "1aa14cb8-c244-402b-aa5d-d8b0cf3fa586",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "UypBpLuuOXcCRYHJ",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "content": "## å¾®ä¿¡å•ç¾¤èŠè‡ªåŠ¨æ€»ç»“å·¥ä½œæµæ¨é€ç½‘é¡µç‰ˆ\n## authorï¼štiger\n## å…¬ä¼—å·ï¼šè€è™èŠAI\ndescriptionï¼šè‡ªåŠ¨å®šæ—¶æ€»ç»“å•ä¸ªå¾®ä¿¡ç¾¤çš„ç¾¤èŠè®°å½•ï¼Œæ—¶é—´å¯ä»¥è‡ªå·±è®¾ç½®ï¼Œæœ€åçš„è¾“å‡ºç»“æœæ¨é€åˆ°GitHubçš„pagesï¼ˆä¸€ä¸ªå…è´¹çš„é™æ€ç½‘é¡µæ‰˜ç®¡å¹³å°ï¼‰ï¼Œæ”¯æŒåœ¨çº¿æµè§ˆã€‚\nè®¿é—®åœ°å€ï¼šhttps://fanwenzhu.github.io/tigerAI-blog/wechat-daily-report-2025-09-01.html   (æ—¥æœŸæ”¹æˆå½“å‰æ—¥æœŸ)\n### æ³¨æ„äº‹é¡¹ï¼š\n1ã€å·¥ä½œæµä¸­çš„AI agentèŠ‚ç‚¹çš„å‡­è¯éœ€è¦æ¢æˆè‡ªå·±çš„å‡­è¯\n2ã€å¾®ä¿¡ç¾¤èŠçš„åç§°éœ€è¦è°ƒæ•´â€œé…ç½®ç¾¤èŠå‚æ•°â€èŠ‚ç‚¹ä¸­çš„å¾®ä¿¡ç¾¤\n3ã€å®šæ—¶æ€»ç»“çš„æ—¶é—´éœ€è¦è°ƒæ•´â€œå®šæ—¶è§¦å‘å™¨â€èŠ‚ç‚¹ä¸­çš„æ—¶é—´\n4ã€chatlog MCPèŠ‚ç‚¹ä¸­çš„sse endpointç›®å‰ä½¿ç”¨çš„æ˜¯dockeré‡Œçš„ç½‘ç»œï¼Œå› ä¸ºæˆ‘æ˜¯ç”¨dockeréƒ¨ç½²çš„n8nå®ä¾‹ï¼Œå¦‚æœä½ æ˜¯æºç éƒ¨ç½²çš„è¯ï¼Œéœ€è¦ä¿®æ”¹",
        "height": 384,
        "width": 496
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -192,
        -320
      ],
      "id": "3637fb77-5631-4bc9-b173-b198ddc7318a",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "sseEndpoint": "http://host.docker.internal:5030/sse",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1,
      "position": [
        608,
        336
      ],
      "id": "3c5aba2b-62ac-4c35-85d1-8ef91b122c13",
      "name": "Chatlog MCP Client"
    }
  ],
  "pinData": {
    "Schedule Trigger": [
      {
        "json": {
          "timestamp": "2025-08-05T02:27:48.843-04:00",
          "Readable date": "August 5th 2025, 2:27:48 am",
          "Readable time": "2:27:48 am",
          "Day of week": "Tuesday",
          "Year": "2025",
          "Month": "August",
          "Day of month": "05",
          "Hour": "02",
          "Minute": "27",
          "Second": "48",
          "Timezone": "America/New_York (UTC-04:00)"
        }
      }
    ]
  },
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "é…ç½®ç¾¤èŠå‚æ•°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "é…ç½®ç¾¤èŠå‚æ•°": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "å¤„ç†AIè¾“å‡º",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å¤„ç†AIè¾“å‡º": {
      "main": [
        [
          {
            "node": "GitHub Pageséƒ¨ç½²",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Chatlog MCP Client": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "saveExecutionProgress": true,
    "saveManualExecutions": true,
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all",
    "executionTimeout": 3600,
    "timezone": "UTC"
  },
  "versionId": "86975ab7-7083-4141-a618-e966d15dcd8e",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "3a9f1808fd9411cdad9f0600c716c707a044601d01fa7c58b647a22ed7dd15bf"
  },
  "id": "hOAKIclq6hMbs4pH",
  "tags": [
    {
      "createdAt": "2025-08-04T09:38:30.407Z",
      "updatedAt": "2025-08-04T09:38:30.407Z",
      "id": "rrh9xQ75GLF9lSh8",
      "name": "å¾®ä¿¡è‡ªåŠ¨åŒ–"
    }
  ]
}